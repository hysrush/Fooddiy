<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.bit.community.dao.ClaimDAO">
  	
	<!-- ||| Claim 게시글 쿼리문 ||| -->
	
	<!-- sql 저장 : 전체 조회 -->
  	<sql id="selectAll_claim">
		SELECT claim_no, claim_title, claim_content, claim_type,
				user_id, user_email, user_phone,
				claim_date, claim_store,
				view_cnt, to_char(reg_at, 'yy-mm-dd') as reg_at
		FROM t_claim
	</sql>
	
  	<!-- DB t_claim와 ClaimBoardVO의 변수와 맞지 않으므로 mapping  -->
  	<resultMap type="claimVO" id="Map_claimVO">
  		<result column="claim_no" property="no"/>
  		<result column="claim_title" property="title"/>
  		<result column="claim_content" property="content"/>
  		<result column="claim_type" property="type"/>
  		<result column="user_id" property="writer"/>
  		<result column="user_email" property="email"/>
  		<result column="user_phone" property="phone"/>
  		<result column="claim_date" property="visitDate"/>
  		<result column="claim_store" property="visitStore"/>
  		<result column="view_cnt" property="viewCnt"/>
  		<result column="reg_at" property="regDate"/>
  	</resultMap>
	
	<!-- 전체 Claim 게시글 조회 -->
	<select id="selectAllClaim" resultMap="Map_claimVO">
		<include refid="selectAll_claim"/>
		ORDER BY claim_no DESC
	</select>
	
	<!-- 글번호별 Claim 게시글 조회 -->
	<select id="selectOneClaim" parameterType="int" resultMap="Map_claimVO" >
		<include refid="selectAll_claim"/>
		WHERE claim_no = #{no}
	</select>
	
	<!-- Claim 글 등록 -->
	<insert id="insertClaim" parameterType="claimVO">
		INSERT INTO t_claim(claim_no, claim_title, claim_content, claim_type,
							user_id, user_email, user_phone, claim_date, claim_store)
		VALUES(seq_t_claim_no.nextval, #{title}, #{content}, #{type},
				#{writer}, #{email}, #{phone}, #{visitDate}, #{visitStore})
	</insert>
	
	<!-- Claim 글 수정 -->
	<update id="modifyClaim" parameterType="claimVO">
		UPDATE t_claim
		SET claim_title = #{title}, claim_content = #{content}, claim_type = #{type},
			user_email = #{email}, user_phone = #{phone}, claim_date = #{visitDate}, claim_store = #{visitStore}
		WHERE claim_no = #{no}
	</update>
	
	<!-- Claim 글 삭제 -->
	<delete id="removeClaim" parameterType="int" >
		DELETE FROM t_claim
		WHERE claim_no = #{no}
	</delete>
	
	<!-- Claim 조회수 증가 -->
	<update id="updateViewcntClaim" parameterType="int">
        UPDATE t_claim
        SET view_cnt = view_cnt + 1
        WHERE claim_no = #{no}
    </update>
    
    <!-- id에 맞는 claim 목록 가져오기 -->
    <select id="selectClaim" resultMap="Map_claimVO" parameterType="java.lang.String">
		<include refid="selectAll_claim"/>
		where user_id = #{id}
	</select>
</mapper>